<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>QR-Net</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script src="/static/scanner.js" defer></script>
</head>
<body>
    <div class="container">
        <h2 class="my-5 text-center">QR-Net</h2>
        <div id="reader" class="shadow-lg p-3 mb-5 bg-white rounded"></div>
        <div id="camera-details" class="mt-4"></div>
        <button onclick="downloadDatabase()" style="display:none;" id="downloadButton">Download Data</button>
      <script>
          let qrData = [];

          function downloadDatabase() {
              let csvContent = "data:text/csv;charset=utf-8,";
              csvContent += qrData.map(e => e.join(",")).join("\n");

              const encodedUri = encodeURI(csvContent);
              const link = document.createElement("a");
              link.setAttribute("href", encodedUri);
              link.setAttribute("download", "qr_data.csv");
              document.body.appendChild(link);
              link.click();
              document.body.removeChild(link);
          }

          function onScanSuccess(decodedText, decodedResult) {
              console.log(`Code detected = ${decodedText}`, decodedResult);
              qrData.push([decodedText]);
              if (qrData.length === 10) {
                  downloadDatabase(); 
                  qrData = [];
              }
          }
      </script>
    </div>
</body>
</html>
